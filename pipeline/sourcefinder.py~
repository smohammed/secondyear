import numpy as np
from scipy.ndimage.filters import maximum_filter
from scipy.ndimage.morphology import generate_binary_structure, binary_erosion
import matplotlib.pyplot as plt
from astropy.io import fits
import scipy.ndimage as ndimage
import scipy.ndimage.filters as filters


#for some reason I had to reshape. Numpy ignored the shape header.
#paws_data = np.loadtxt("paws.txt").reshape(4,11,14)

#getting a list of images
#paws = [p.squeeze() for p in np.vsplit(paws_data,4)]

c1 = fits.open('../corrcsv/00005_0001galcorr.csv.fits')[1].data

data = c1

data_max = filters.maximum_filter(data, neighborhood_size)
maxima = (data == data_max)
data_min = filters.minimum_filter(data, neighborhood_size)
diff = ((data_max - data_min) > threshold)
maxima[diff == 0] = 0

labeled, num_objects = ndimage.label(maxima)
slices = ndimage.find_objects(labeled)
x, y = [], []
for dy,dx in slices:
    x_center = (dx.start + dx.stop - 1)/2
    x.append(x_center)
    y_center = (dy.start + dy.stop - 1)/2    
    y.append(y_center)

plt.imshow(data,vmin=0,vmax=1.4,origin='lower',interpolation='nearest',aspect='auto',cmap=cm.gray)
plt.plot(x,y, 'ro')
plt.show()